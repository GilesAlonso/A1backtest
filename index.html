<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OHLC EdgeFinder Visualizer</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="container">
    <div id="controls">
      <div class="control-group">
        <span>Theme:</span>
        <button class="theme-btn active" data-theme="light">Light</button>
        <button class="theme-btn" data-theme="dark">Dark</button>
      </div>
      
      <div class="control-group">
        <span>Moving Averages:</span>
        <label class="ma-toggle">
          <input type="checkbox" id="ma3" checked>
          <span class="ma-color" style="background: #FF6B6B;"></span> 3D
        </label>
        <label class="ma-toggle">
          <input type="checkbox" id="ma14">
          <span class="ma-color" style="background: #4ECDC4;"></span> 14D
        </label>
        <label class="ma-toggle">
          <input type="checkbox" id="ma20" checked>
          <span class="ma-color" style="background: #45B7D1;"></span> 20D
        </label>
        <label class="ma-toggle">
          <input type="checkbox" id="ma50" checked>
          <span class="ma-color" style="background: #96CEB4;"></span> 50D
        </label>
        <label class="ma-toggle">
          <input type="checkbox" id="ma100">
          <span class="ma-color" style="background: #FECA57;"></span> 100D
        </label>
        <label class="ma-toggle">
          <input type="checkbox" id="ma200" checked>
          <span class="ma-color" style="background: #FF9FF3;"></span> 200D
        </label>
      </div>
    </div>
    <div id="chart-container"></div>
  </div>

  <script>
    // This is the fix - we're creating a proper Looker Studio data structure for standalone mode
    function createMockLookerData() {
      return {
        tables: [{
          columns: [
            {name: 'date'},
            {name: 'open'},
            {name: 'high'},
            {name: 'low'},
            {name: 'close'},
            {name: 'score'},
            {name: 'ticker'}
          ],
          rows: [
            ['2024-01-01', '100', '105', '98', '103', '3', 'AAPL'],
            ['2024-01-02', '103', '108', '102', '107', '6', 'AAPL'],
            ['2024-01-03', '107', '110', '105', '106', '-3', 'AAPL'],
            ['2024-01-04', '106', '109', '104', '108', '-6', 'AAPL'],
            ['2024-01-05', '108', '112', '107', '111', '4', 'AAPL'],
            ['2024-01-06', '111', '115', '110', '114', '7', 'AAPL'],
            ['2024-01-07', '114', '116', '112', '113', '-2', 'AAPL'],
            ['2024-01-08', '113', '118', '112', '117', '-7', 'AAPL']
          ]
        }]
      };
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      let visualization = null;
      
      // Theme toggle functionality
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          const theme = this.getAttribute('data-theme');
          if (visualization) {
            visualization.setTheme(theme);
          }
        });
      });
      
      // MA toggle functionality
      document.querySelectorAll('input[type="checkbox"][id^="ma"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          if (visualization) {
            visualization.draw(createMockLookerData());
          }
        });
      });
      
      // Initialize visualization
      visualization = new OHLCVisualization();
      
      // Draw the chart with mock data
      visualization.draw(createMockLookerData());
      
      // Handle window resize
      window.addEventListener('resize', function() {
        if (visualization) {
          visualization.updateSize(
            document.getElementById('chart-container').offsetWidth,
            document.getElementById('chart-container').offsetHeight || 500
          );
        }
      });
    });
  </script>
  <script src="visualization.js"></script>
</body>
</html>
